'use strict';var ThemifyBuilderCommon;
(function(g,l){var q={},r={isLoaded:null,options:null,labels:null,lightbox:null,lightboxContainer:null,type:null,conditions:null,pageId:null,id:null,is_template_support:"content"in document.createElement("template"),isSaved:null,showLoader:function(b){var e=document.body.classList;b?e.add("tbp_loading"):e.remove("tbp_loading")},init:function(){SimpleBar.removeObserver();this.pageId=themifyBuilder.pageId;this.options=_tbp_app.options;this.labels=themifyBuilder.labels;_tbp_app.options=themifyBuilder.labels=
themifyBuilder.pageId=null;document.body.classList.add("tbp_page");document.body.classList.add(this.pageId+"_page");var b=document.getElementById("tmpl-tbp_builder_lightbox"),e=document.getElementsByClassName("page-title-action")[0],d=document.getElementsByClassName("tbp_lightbox_edit"),n=document.createElement("div");n.className="tbp_admin_import "+this.pageId+"_import";n.innerHTML=themifyBuilder.import_btn?themifyBuilder.import_btn:"";this.is_template_support?document.body.appendChild(b.content):
document.body.insertAdjacentHTML("beforeend",b.innerHTML);this.lightbox=document.getElementById("tb_lightbox_parent");this.lightboxContainer=this.lightbox.getElementsByClassName("tb_options_tab_wrapper")[0];this.lightbox.getElementsByClassName("ti-close")[0].addEventListener("click",this.close.bind(this));e.addEventListener("click",this.edit.bind(this));themifyBuilder.import_btn&&(e.parentNode.insertBefore(n,e.nextSibling),themify_create_pluploader(g(n.firstElementChild)),b=document.createElement("DIV"),
b.className="alert",document.body.appendChild(b));for(b=d.length-1;-1<b;--b)d[b].addEventListener("click",this.edit.bind(this));void 0!==_tbp_app.draftBtn&&(this.lightbox.getElementsByClassName("tbp_submit_draft_btn")[0].textContent=_tbp_app.draftBtn);this.lightbox.getElementsByClassName("tbp_btn_save")[0].textContent=_tbp_app.publishBtn;ThemifyBuilderCommon={Lightbox:{$lightbox:g(this.lightbox)}};setTimeout(function(){var e=document.createElement("link"),b=document.createElement("div");e.href=_tbp_app.api_base;
e.rel="prerender prefetch";b.className="tb_busy";document.head.appendChild(e);document.body.appendChild(b);this.pointerInit()}.bind(this),500);themifyBuilder.import_btn=null},getValue:function(b){if(void 0!==ThemifyConstructor.values[b])return ThemifyConstructor.values[b];for(var e=this.options.length-1;-1<e;--e)if(this.options[e].id===b)return void 0===this.options[e].options?this.options[e]:Object.keys(this.options[e].options)[0];return null},import_sample_content:function(b,e,d){g.ajax({url:b,
dataType:"json",success:function(b){function q(){if(0!==r.length&&!(5<n)){var a=r.shift();++n;g.ajax({url:ajaxurl,dataType:"json",type:"POST",data:a,success:function(a){--n;q();1>n&&d()}})}}var r=[],n=0;void 0!==b.terms&&g.each(b.terms,function(a,c){r.push({action:"tbp_import_term",term:c})});void 0!==b.posts&&g.each(b.posts,function(a,c){r.push({action:"tbp_import_post",theme_id:e,post:c})});if(0===r.length)d();else for(b=0;5>b;b++)q()}})},createCustomTypes:function(){var b=this.lightbox.getElementsByClassName("builder_button_edit")[0];
b.textContent=null!==this.id?"tbp_theme"===this.pageId&&_tbp_app.active!=this.id?_tbp_app.publishBtn:this.labels.save:_tbp_app.next;if(void 0===ThemifyConstructor.tbp_type){var e=this,d={},n={},E=void 0,F=function(a,c,h){g.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",beforeSend:function(){e.showLoader(!0)},data:{type:e.pageId,id:c,is_draft:a||0,action:e.pageId+"_saving",data:h,tb_load_nonce:themifyBuilder.tb_load_nonce},complete:function(){e.showLoader()},success:function(a){if(a)if(a.redirect)if("tbp_theme"===
e.pageId){var h=g(".layout_preview_list.selected",e.lightbox),c=h.attr("data-slug");if("blank"===c)window.location=a.redirect;else{var m=a.redirect.match(/id=(\d+)/)[1];setTimeout(function(){e.showLoader(!0)},200);r.import_sample_content("https://themify.me/public-api/builder-pro-demos/pro-"+c+"-templates.json",m,function(){g(".tbp_import_demo input",h).is(":checked")?r.import_sample_content("https://themify.me/public-api/builder-pro-demos/pro-"+c+".json",m,function(){window.location=a.redirect}):
window.location=a.redirect})}}else window.location=a.redirect;else"tbp_theme"===e.pageId?(e.lightbox.getElementsByClassName("ti-close")[0].click(),window.location.reload()):(e.lightbox.classList.add("tbp_lightbox_is_saved"),setTimeout(function(){e.lightbox.classList.remove("tbp_lightbox_is_saved")},2E3)),e.isSaved=!0}})},G=function(a){document.body.classList.add("tbp_step_2");var c=_tbp_app.api_base,h=_tbp_app.demo_base,p=a.tbp_template_type,k=e.lightbox.getElementsByClassName("tb_options_tab_content"),
f=function(c){var f=document.createDocumentFragment(),b=document.createElement("div"),m=document.createElement("ul"),d=void 0!==k[1]?k[1].getAttribute("data-"+p+"-selected"):null;b.className="tbp_predesigned_row_container";b.id=e.pageId+"_import";m.className="tbp_predesigned_theme_lists";void 0!==c[0]&&"blank"===c[0].slug||c.unshift({slug:"blank",link:"#",title:{rendered:_tbp_app.blank},id:""});for(var t=0,r=c.length;t<r;++t){var q=document.createElement("li"),n=document.createElement("img"),v=document.createElement("div"),
A=document.createElement("div"),B=document.createElement("div"),z=document.createElement("a"),C=document.createElement("a"),x=document.createElement("i"),l=document.createElement("div");q.className="layout_preview_list";q.setAttribute("data-slug",c[t].slug);c[t].id&&q.setAttribute("data-id",c[t].id);l.className="layout_preview";v.className="thumbnail";A.className="layout_action";B.className="layout_title";z.className="layout-checked-link";z.title=c[t].title.rendered;x.className="ti-check";if(d===
c[t].slug||!d&&"blank"===c[t].slug)q.className+=" selected";"blank"===c[t].slug&&(l.className+=" layout_preview_blank");c[t].link&&"#"!==c[t].link?(z.href=C.href=h+c[t].slug,C.target="_blank",C.innerHTML=c[t].title.rendered,B.appendChild(C)):B.innerHTML=c[t].title.rendered;n.src=c[t].tbp_image_full?c[t].tbp_image_full:themifyBuilder.ph_image;n.alt=c[t].title.rendered;v.appendChild(n);z.appendChild(x);A.appendChild(B);A.appendChild(z);l.appendChild(v);l.appendChild(A);q.appendChild(l);"tbp_theme"===
e.pageId&&(x=document.createElement("input"),n=document.createElement("span"),x.type="checkbox",v=document.createElement("label"),v.className="tbp_import_demo",v.appendChild(x),v.appendChild(document.createTextNode(tbpAdminVars.i18n.import)),n.appendChild(document.createTextNode(tbpAdminVars.i18n.import_warning)),v.appendChild(n),q.appendChild(v));f.appendChild(q)}m.appendChild(f);b.appendChild(m);c=e.lightbox.getElementsByClassName("tbp_lightbox_title")[0];f=document.createElement("a");x=document.createElement("i");
f.className="tbp_wizard_step_prev";f.href="#";x.className="ti-arrow-left";f.appendChild(x);c.innerHTML="";c.appendChild(f);c.appendChild(document.createTextNode(_tbp_app.import));f.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();document.body.classList.remove("tbp_step_2");k[1].style.display="none";k[0].style.display="";this.parentNode.innerHTML=_tbp_app.add_template});void 0!==k[1]?(k[1].innerHTML="",k[1].appendChild(b),k[1].style.display=""):(c=document.createElement("div"),
c.className="tb_options_tab_content",c.appendChild(b),k[0].parentNode.insertBefore(c,k[0].nextSibling));k[0].style.display="none";m.addEventListener("click",function(a){null===a.target.closest(".layout_title, .tbp_import_demo")&&(a.stopPropagation(),a.preventDefault());a=a.target.closest(".layout_preview_list");if(null!==a&&!a.classList.contains("selected")){for(var c=this.children,h=c.length-1;-1<h;--h)c[h].classList.contains("selected")&&c[h].classList.remove("selected");a.classList.add("selected");
k[1].setAttribute("data-"+p+"-selected",a.dataset.slug)}});g(e.lightbox).find(".tbp_step_2_actions").first().off("click").on("click",function(c){if(c.target.classList.contains("tbp_submit_draft_btn")||c.target.classList.contains("tbp_btn_save"))c.stopPropagation(),c.preventDefault(),a["import"]=m.getElementsByClassName("selected")[0].getAttribute("data-slug"),F(c.target.classList.contains("tbp_submit_draft_btn"),null,a)})};void 0!==p?c+=p:p="theme";void 0===n[p]?(k[0].classList.add("tb_busy"),g.getJSON(c,
function(a){n[p]=a;f(a)}).always(function(){k[0].classList.remove("tb_busy")}).fail(function(){f([])})):f(n[p])};ThemifyConstructor.tbp_image={change:function(a){a.preventDefault();a.stopPropagation();a=g(a.currentTarget).parent().children("input").first();a.val("").trigger("change");l.triggerEvent(a[0],"change")},render:function(a,c){var h=c.image.render(a,c);a={id:a.id+"_id"};h.getElementsByClassName("tb_clear_input")[0].addEventListener("click",this.change.bind(this));h.appendChild(c.hidden.render(a,
c));return h}};ThemifyConstructor.tbp_type={id:null,render:function(a,c){void 0===E&&(E=a.binding);this.id=a.id;r.type=r.getValue(this.id);a=c.select.render(a,c);a.querySelector("select").addEventListener("change",function(a){a.stopPropagation();r.type=this.value;ThemifyConstructor.condition.reInit()},{passive:!0});return a}};ThemifyConstructor.condition={id:null,reInit:function(){var a=document.getElementById(this.id);a.innerHTML="";a.parentNode.replaceChild(this.render(r.conditions,ThemifyConstructor),
a)},includeRender:function(a,c){var h=document.createElement("div"),b=document.createElement("select"),e={id:"include",options:{"in":_tbp_app.include,ex:_tbp_app.exclude}};h.className="tbp_include tbp_inner_block";b.appendChild(c.select.make_options(e,a.include,c));b.setAttribute("data-id",e.id);h.appendChild(b);return h},renderSelect:function(a,c){var h=document.createDocumentFragment(),b=document.createElement("select"),e=function(a,h,f,b){var e=document.createElement("option");e.value=a;e.textContent=
h;if(a===c||b===a&&null===r.id)e.selected=!0;void 0!==f&&e.setAttribute("data-hasQuery",f?1:0);return e},f;for(f in a)if("optgroup"===f)for(var m=0,u=a[f].length;m<u;++m){var d=document.createElement("optgroup"),y=document.createDocumentFragment();d.label=a[f][m].label;d.setAttribute("data-id",a[f][m].id);for(var w in a[f][m].options){var t=a[f][m].options[w];y.appendChild(e(w,void 0!==t.label?t.label:t,t.has_query,a[f][m].selected))}d.appendChild(y);h.appendChild(d)}else h.appendChild(e(f,a[f].label,
a[f].has_query,a[f].selected));b.appendChild(h);return b},renderGeneral:function(a,c,h){var b=document.createDocumentFragment(),e=this;a=this.renderSelect(a,c.general);var f=function(a){a.addEventListener("change",function(a){a.stopPropagation();var b=r.conditions.options[r.type][this.value];a=this.closest(".selectwrapper");var p=this.options[this.selectedIndex],d=null,k=a.nextSibling;if(null!==k){var m=k.nextSibling;k.parentNode.removeChild(k);k=null;null!==m&&m.parentNode.removeChild(m)}"1"==p.getAttribute("data-hasQuery")&&
(d=!0);void 0!==b?void 0!==b.options&&(b=e.renderSelect(b.options,c.query),f(b),a.parentNode.insertBefore(e.addSelectWrapper(b,"query"),k),void 0!==c.query&&l.triggerEvent(b,"change")):null!==d||p.hasAttribute("data-hasQuery")||(d=p.parentNode,d=(d="OPTGROUP"===d.nodeName?d.getAttribute("data-id"):!1)&&"all_"+d!==this.value);!0===d&&a.parentNode.insertBefore(e.renderSinlgeItems(c.detail,h),k)},{passive:!0})};f(a);b.appendChild(this.addSelectWrapper(a,"general"));l.triggerEvent(a,"change");return b},
renderSinlgeItems:function(a,c){var b=document.getElementById("tmpl-tbp_pagination"),d=document.createElement("div"),k=this;d.className="tbp_inner_block selectwrapper tbp_pagination_wrapper";e.is_template_support?d.appendChild(b.content.cloneNode(!0)):d.insertAdjacentHTML("beforeend",b.innerHTML);var f=d.getElementsByClassName("tbp_pagination_all")[0],m=d.getElementsByClassName("tbp_pagination_header")[0],u=function(a,c){a.checked?m.textContent=m.getAttribute("data-all"):(!0===c&&k.loadData(d),m.textContent=
m.getAttribute("data-select"))};m.addEventListener("click",function(a){a.preventDefault();var c=this.parentNode,b=function(){!0!==f.checked&&k.saveCheckboxes(d);c.classList.remove("tbp_pagination_active");document.removeEventListener("click",h,{passive:!0})},h=function(a){d.contains(a.target)||b()};c.classList.contains("tbp_pagination_active")?b():(c.classList.add("tbp_pagination_active"),!1!==f.checked||f.hasAttribute("done")||(f.setAttribute("done",!0),k.loadData(d)),document.addEventListener("click",
h,{passive:!0}))});f.addEventListener("change",function(a){a.stopPropagation();u(this,!0)},{passive:!0});void 0!==a&&(f.checked=!1,u(f,null),b=d.closest(".tbp_condition_repeat"),null!==b&&(c=b.getAttribute("data-index")),q[c]=a);return d},loadData:function(a,c,b,e){for(var h=a,f=this;null!==h&&(h=h.previousElementSibling,!h.classList.contains("tbp_block_item")||null===h.offsetParent););if(null!==h){(c=parseInt(c))||(c=1);var m=a.getElementsByClassName("tbp_pagination_result_wrap")[0],u=h.getElementsByTagName("select")[0].value,
p=function(h){var d=document.createElement("div"),k=document.createDocumentFragment(),p=h.data,r=a.closest(".tbp_condition_repeat").getAttribute("data-index"),y=h.count,g=h.limit;m.innerHTML="";d.className="tbp_pagination_result";for(var l in p){var D=document.createElement("label"),w=document.createElement("input");w.type="checkbox";w.value=l;w.name=u;void 0!==q[r]&&void 0!==q[r][l]&&(w.checked=!0);D.appendChild(w);D.insertAdjacentHTML("beforeend",p[l]);k.appendChild(D)}d.appendChild(k);m.appendChild(d);
if(y>g){k=document.createElement("div");p=document.createDocumentFragment();k.className="tbp_pagination_list";l=1;for(y=Math.ceil(y/g);l<=y;++l)g=document.createElement("a"),g.href="#",g.className="page_numbers",g.textContent=l,c===l&&(g.className+=" current"),g.setAttribute("data-number",l),p.appendChild(g);k.appendChild(p);k.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();c=c.target.getAttribute("data-number");f.saveCheckboxes(a);c&&f.loadData(a,c,b,e)});m.appendChild(k)}d=
d.closest(".tbp_pagination_search").getElementsByClassName("tbp_pagination_search_input")[0];void 0!==d&&void 0===b&&(d.addEventListener("search",n),d.addEventListener("input",n));e&&e(h,m,c)},n=function(c){c.preventDefault();c.stopPropagation();b=c.target.value;f.isSearching=!0;f.saveCheckboxes(a);1<b.length?f.loadData(a,1,b,e):(d[u]={},f.loadData(a,1,null,e))};void 0===d[u]||void 0===d[u][c]||f.isSearching?g.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",beforeSend:function(){m.classList.add("tb_busy")},
data:{action:"tbp_load_data",p:c,s:b,type:u,tb_load_nonce:themifyBuilder.tb_load_nonce},complete:function(){m.classList.remove("tb_busy")},success:function(a){void 0===d[u]&&(d[u]={});(d[u][c]=a)&&0<a.count&&p(a);f.isSearching=!1}}):0<d[u][c].count&&p(d[u][c])}},saveCheckboxes:function(a){var c=a.getElementsByTagName("input");a=a.closest(".tbp_condition_repeat").getAttribute("data-index");void 0===q[a]&&(q[a]={});for(var b=c.length-1;-1<b;--b){var e=c[b].value;!0===c[b].checked?q[a][e]=!0:void 0!==
q[a][e]&&delete q[a][e]}},renderRepeat:function(a,c,b,e){var d=document.createDocumentFragment(),f=document.createElement("div"),h=document.createElement("div"),p=document.createElement("a");f.className="tbp_condition_repeat";h.className="tbp_condition_repeat_inner";c=null!==c?c:this.setIndex();f.setAttribute("data-index",c);p.className="ti-close tbp_delete_repeater";p.href="#";h.appendChild(this.includeRender(b,e));h.appendChild(this.renderGeneral(a,b,c));d.appendChild(h);d.appendChild(p);f.appendChild(d);
p.addEventListener("click",function(a){a.preventDefault();a=f.closest(".tbp_condition_repeat").dataset.index;void 0!==q[a]&&delete q[a];f.parentNode.removeChild(f)});return f},render:function(a,c){this.id=a.id;var b=document.createElement("div"),e=r.type,d=document.createElement("a");b.className="tb_lb_option tbp_condition_wrap";b.id=a.id;null===r.conditions&&(r.conditions=a);if(void 0!==a.options[e]){d.className="add_new tb_icon add";d.href="#";d.textContent=_tbp_app.add_conition;var f=ThemifyConstructor.values[a.id],
m=document.createDocumentFragment();if(void 0===f||0===f.length)f=[{}];for(var g=0,n=f.length;g<n;++g)m.appendChild(this.renderRepeat(a.options[e],g,f[g],c));b.appendChild(m);d.addEventListener("click",function(b){b.preventDefault();var d=this.renderRepeat(a.options[e],null,{},c);b.currentTarget.before(d)}.bind(this));b.appendChild(d)}return b},setIndex:function(){for(var a=e.lightboxContainer.getElementsByClassName("tbp_condition_repeat"),c=void 0!==a[0]?parseInt(a[0].getAttribute("data-index")):
0,b=a.length-1;0<b;--b){var d=parseInt(a[b].getAttribute("data-index"));c<d&&(c=d)}return++c},addSelectWrapper:function(a,c){var b=document.createElement("div");b.className="selectwrapper tbp_inner_block";void 0!==c&&(b.className+=" tbp_block_item tbp_block_"+c,a.setAttribute("data-id",c));b.appendChild(a);return b}};b.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();document.body.click();a=e.lightbox.getElementsByClassName("tb_lb_option");for(var c={},b=a.length-1;-1<b;--b)if(a[b].classList.contains("tbp_condition_wrap")){for(var d=
a[b].getElementsByClassName("tbp_condition_repeat"),k=[],f=0,m=d.length;f<m;++f){k[f]={};for(var g=d[f].getElementsByClassName("tbp_inner_block"),n=g.length-1;-1<n;--n)if(null!==g[n].offsetParent){var l=g[n].classList;l.contains("tbp_include")?(l=g[n].getElementsByTagName("select")[0],"in"!==l.value&&(k[f][l.getAttribute("data-id")]=l.value)):l.contains("tbp_pagination_wrapper")?!0!==g[n].getElementsByClassName("tbp_pagination_all")[0].checked&&(l=d[f].getAttribute("data-index"),void 0!==q[l]&&(k[f].detail=
q[l])):l.contains("tbp_block_item")&&(l=g[n].getElementsByTagName("select")[0],k[f][l.getAttribute("data-id")]=l.value)}}c[a[b].getAttribute("id")]=k}else if(null!==a[b].offsetParent||"hidden"===a[b].type||a[b].classList.contains("tb_uploader_input"))c[a[b].getAttribute("id")]=a[b].value.trim();null===e.id?G(c):F(!1,e.id,c)})}},edit:function(b){b.preventDefault();b.stopPropagation();if(this.id=b.currentTarget.getAttribute("data-post-id")){if(null===this.isLoaded&&(l.LoadCss(themifyBuilder.builderToolbarUrl,
themifyBuilder.v),l.LoadCss(themifyBuilder.builderCombineUrl,themifyBuilder.v)),!document.body.classList.contains("tbp_loading")){var e=this;g.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",beforeSend:function(){e.showLoader(!0)},data:{id:this.id,action:this.pageId+"_get_item",tb_load_nonce:themifyBuilder.tb_load_nonce},success:function(b){b&&(e.run(_tbp_app.edit_template,b),e.showLoader(),e=null)}})}}else this.run(_tbp_app.add_template,{})},close:function(b){b.preventDefault();b.stopPropagation();
if(!0===this.isSaved)window.location.reload();else for(this.lightbox.classList.remove("tbp_lightbox");null!==this.lightboxContainer.firstChild;)this.lightboxContainer.removeChild(this.lightboxContainer.firstChild)},run:function(b,e){document.body.classList.remove("tbp_step_2");void 0===b&&(b="");var d=this,g=function(){ThemifyConstructor.values=e;q={};ThemifyConstructor.label=d.labels;var g=[{type:"group",options:d.options,wrap_class:"tb_options_tab_content"}];"tbp_no_theme_activated"!==d.options[0].id||
d.id?"tbp_no_theme_activated"===g[0].options[0].id&&(g[0].options=d.options.slice(1)):(g[0].options=d.options.slice(0,1),d.lightbox.getElementsByClassName("builder_button_edit")[0].addEventListener("click",function(b){d.id||(b.preventDefault(),b.stopPropagation(),window.location.href=d.options[0].theme_page_url)},{once:!0}));d.createCustomTypes();d.lightbox.getElementsByClassName("tbp_lightbox_title")[0].innerHTML=b;d.lightboxContainer.appendChild(ThemifyConstructor.create(g));ThemifyConstructor.callbacks();
d.lightbox.classList.add("tbp_lightbox");new SimpleBar(d.lightboxContainer)};null===this.isLoaded?(this.isLoaded=!0,l.LoadCss(themifyBuilder.builderToolbarUrl,themifyBuilder.v),l.LoadCss(themifyBuilder.builderCombineUrl,themifyBuilder.v),l.LoadAsync(themifyBuilder.constructorUrl,g,themifyBuilder.v,null,function(){return"undefined"!==typeof ThemifyConstructor})):g()},pointerInit:function(){if("undefined"!==typeof _tbp_pointers)for(var b=_tbp_pointers.pointers.length-1;0<=b;b--)this.pointerOpen(_tbp_pointers.pointers[b])},
pointerOpen:function(b){var e=g(b.target);if(0!==e.length){var d=g.extend(b.options,{close:function(){b.remember_dismiss&&g.post(ajaxurl,{pointer:b.pointer_id,action:"dismiss-wp-pointer"})}});e.pointer(d).pointer("open")}}};g(function(){r.init()})})(jQuery,Themify);
