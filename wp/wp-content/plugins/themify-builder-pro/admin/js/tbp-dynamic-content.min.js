'use strict';(function(m,n){var e={},p=null,u={},r=tbpDynamic.field_name,q,x=function(a){if(null===p){var d=Themify.hash(tbpDynamic.v+Object.keys(tbpDynamic.items));p=function(){if(themifyBuilder.debug)return null;try{var a=sessionStorage.getItem("tbp_dc");if(a&&(a=JSON.parse(a),a.h===d&&a.v))return a.v}catch(c){}return null}();null===p&&m.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tpb_get_dynamic_content_fields",tb_load_nonce:themifyBuilder.tb_load_nonce},error:function(){p=
null},success:function(b){p=b;try{sessionStorage.setItem("tbp_dc",JSON.stringify({v:b,h:d}))}catch(c){}a&&a()}})}else a&&a()},D=function(a,d){var b="",c="",g=function(a){if(void 0!==c||void 0!==b)a||(a=""),void 0!==c&&(a=c+a),void 0!==b&&(a+=b);d&&d(a)};if("string"!==typeof a){if(!a||void 0===a.item)return;a=m.extend(!0,{},a);b=a.text_after;c=a.text_before;delete a.text_before;delete a.text_after;delete a.o;a=JSON.stringify(a)}var f;n.Forms.LayoutPart.id&&document.body.classList.contains("tbp_app_is_edit")&&
(f=n.Instances.Builder[n.builderIndex].el.parentNode.id)&&(f=f.split("-")[1]);f||(f="undefined"===typeof tbp_local||void 0===tbp_local.id||tbp_local.isArchive?themifyBuilder.post_ID:tbp_local.id);var e=Themify.hash(a+f);void 0===u[e]?m.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tpb_get_dynamic_content_preview",tb_load_nonce:themifyBuilder.tb_load_nonce,pid:f,values:a},success:function(a){u[e]=a.error?a.error:""===a.value||"false"===a.value?null:a.value;g(u[e])}}):g(u[e])},
E=function(a,d){var b=ThemifyConstructor.values,c=document.createElement("div"),g=Object.values(m.extend(!0,{},p)),e=tbpDynamic.items;c.className="tbp_dynamic_content_options";for(var h=g.length-1;-1<h;--h)if("item"===g[h].id){h=g[h].options;for(var k in h){for(var l in h[k].options)void 0!==e[l]&&-1===e[l].type.indexOf(a)&&delete h[k].options[l];0===Object.keys(h[k].options).length&&delete h[k]}break}void 0===d&&(d={});ThemifyConstructor.values=d;a=ThemifyConstructor.create(g);d=a.querySelectorAll(".tb_lb_option");
for(h=d.length-1;-1<h;--h)d[h].classList.remove("tb_lb_option"),d[h].classList.remove("tb_lb_option_child");ThemifyConstructor.values=b;c.appendChild(a);return c},C=function(a,d){var b=a.parentNode.closest(".tb_field"),c=v(b),g=F(b),f=b.getElementsByClassName("tb_input")[0],h={};void 0!==f&&f.parentNode.classList.contains("tb_has_dc")&&(b=f,f=null);var k=G(b,g);null!==c?void 0!==e[c]&&(f=w(b),void 0!==e[c][f]&&(h=e[c][f])):h=e;if(!0===d)if(void 0!==h[k])a.checked=!0;else return;if(!0===a.checked){b.classList.add("tbp_dc_active");
var l=b.getElementsByClassName("tbp_dc_input")[0];void 0===l?(x(function(){var a=document.createElement("div");l=document.createElement("input");a.className="tbp_dc_wrap";l.className="tbp_dc_input xlarge";l.type="text";l.setAttribute("readonly",!0);var d=function(a){a=a.closest(".tbp_dc_wrap");var b=a.querySelector("#item"),d=b.value,c=b.closest(".tb_field").nextElementSibling.children,e="field_"+d,f=[],h="field_general_"+g;l.value=b.options[b.selectedIndex].text;f.push(b.parentNode);for(var m=c.length-
1;-1<m;--m)""!==d&&(c[m].classList.contains(e)||c[m].classList.contains(h))?(c[m].style.display="block",f.push(c[m])):c[m].style.display="";ThemifyConstructor.callbacks();d||(f=null);var n=y(k,f,a);f=null;D(n,function(a){null===a&&(a="image"===g?tbpDynamic.placeholder_image:"{"+n.item+"}");var c=t(b,k);if(null!==c){c.value=a;var d=null;"wp_editor"===g&&(d=tinymce.get(c.id))&&(d.setContent(String(a)),d.fire("change"));d||(Themify.triggerEvent(c,"change"),"image"!==g&&"SELECT"!==c.nodeName&&Themify.triggerEvent(c,
"keyup"))}})};l.addEventListener("click",function(a){a.preventDefault();a.stopImmediatePropagation();var b=this.nextElementSibling;null===b&&(b=E(g,h[k]),m(b).on("change.dc_preview",":input",function(a){a.stopPropagation();d(a.target)}),this.parentNode.appendChild(b));a="block"!==b.style.display;for(var c=ThemifyBuilderCommon.Lightbox.$lightbox[0].getElementsByClassName("tbp_dynamic_content_options"),e=c.length-1;-1<e;--e)c[e].style.display="";if(!0===a){var f=function(a){null===a.target.closest(".tbp_dc_wrap")&&
(document.removeEventListener("mousedown",f,{passive:!0}),"visual"===n.mode&&window.top.document.removeEventListener("mousedown",f,{passive:!0}),b.style.display="");"visual"===n.mode&&m(document).triggerHandler("mouseup")};document.addEventListener("mousedown",f,{passive:!0});"visual"===n.mode&&window.top.document.addEventListener("mousedown",f,{passive:!0});d(this);b.style.display="block"}else b.style.display=""});a.appendChild(l);if(void 0!==h[k]){var c=h[k].item,e=p[0].options,f;for(f in e)if(void 0!==
e[f].options[c]){l.value=e[f].options[c];break}if("image"===g&&"styling"===ThemifyConstructor.clicked)for(c=b.closest(".tb_tab").getElementsByClassName("tb_image_options"),f=c.length-1;-1<f;--f)c[f].classList.remove("_tb_hide_binding");else ThemifyConstructor.callbacks()}b.appendChild(a)}),void 0===d&&A(b,k,g)):void 0===d&&(A(b,k,g),void 0!==h[k]&&l.click(),B(!1))}else void 0===d&&(H(b,k,g),b.classList.remove("tbp_dc_active"),y(k,null,b),B(!0))},w=function(a){return m(a.closest(".tb_repeatable_field")).index()},
v=function(a){a=a.parentNode.closest(".tb_row_js_wrapper");return null!==a?a.getAttribute("id"):null},B=function(a){if("visual"===n.mode&&"styling"===ThemifyConstructor.clicked){var d=n.liveStylingInstance.$liveStyledElmt[0].closest(".tb_active_layout_part");null===d&&(d=n.liveStylingInstance.$liveStyledElmt[0]);d=d.getElementsByClassName("tbp_dc_styles");for(var b=d.length-1;-1<b;--b)d[b].sheet.disabled=a}},G=function(a,d){d="image"===d?"tb_uploader_input":null!==a.parentNode.closest(".tb_repeatable_field_content")?
"tb_lb_option_child":"tb_lb_option";a=a.getElementsByClassName(d)[0];var b;void 0!==a&&(b=a.getAttribute("data-input-id"));b||(b=a.getAttribute("id"));return b.trim()},y=function(a,d,b){var c=null,g=v(b);null!==g&&(c=w(b));if(null===d)if((b=JSON.parse(q.value))||(b={}),null!==c){var f=!1;if(void 0!==b[g]){if(null===a)void 0!==b[g][c]&&(f=!0,delete e[g][c],delete b[g][c]);else if(void 0!==b[g][c]&&void 0!==b[g][c][a]){if(f=!0,delete b[g][c][a],a=Object.keys(b[g][c]).length,0===a||1===a&&void 0!==b[g][c].o)f=
!0,delete e[g][c],delete b[g][c]}else return;0===Object.keys(b[g]).length&&(f=!0,delete e[g],delete b[g])}if(!1===f)return}else if(void 0!==b[a])delete b[a];else return;else{null!==c?(void 0===e[g]&&(e[g]={}),void 0===e[g][c]&&(e[g][c]={}),void 0===e[g][c][a]&&(e[g][c][a]={}),b=void 0!==e[g][c][a].o?e[g][c][a].o:null):(void 0===e[a]&&(e[a]={}),b=void 0!==e[a].o?e[a].o:null);if(Array.isArray(d)){f={};for(var h=d.length-1;-1<h;--h)for(var k=d[h].querySelectorAll("input,textarea,select"),l=k.length-
1;-1<l;--l){var m=k[l].value;""===m||k[l].parentNode.parentNode.classList.contains("_tb_hide_binding")||(f[k[l].id]=m)}d=n.Utils.clear(f)}null!==c?(e[g][c][a]=d,null!==b&&(e[g][c][a].o=b)):(e[a]=d,null!==b&&(e[a].o=b));b=e}q.value=JSON.stringify(b);return d},t=function(a,d){a=a.closest(".tb_repeatable_field_content");return a=null!==a?a.querySelector('.tb_lb_option_child[data-input-id="'+d+'"]'):ThemifyBuilderCommon.Lightbox.$lightbox[0].querySelector("#"+d)},A=function(a,d,b){var c=null,g=null,f=
d;"wp_editor"===b?(b=tinymce.get(d),b||(b=t(a,d),b=tinymce.get(b.id)),b&&(c=b.getContent())):(b=t(a,d),null!==b&&(c=b.value));b=v(a);null!==b&&(g=w(a),f=b);null!==c&&""!==c?(void 0===e[f]&&(e[f]={}),null!==g?(void 0===e[f][g]&&(e[f][g]={}),void 0===e[f][g][d]&&(e[f][g][d]={}),e[f][g][d].o=c):e[f].o=c):void 0!==e[f]&&(null!==g?void 0!==e[f][g]&&void 0!==e[f][g][d]&&delete e[f][g][d].o:delete e[f].o);q.value=JSON.stringify(e);return c},H=function(a,d,b){var c=v(a),g="";if(null!==c){if(void 0!==e[c]){var f=
w(a);void 0!==e[c][f]&&void 0!==e[c][f][d]&&void 0!==e[c][f][d].o&&(g=e[c][f][d].o)}}else void 0!==e[d]&&void 0!==e[d].o&&(g=e[d].o);"wp_editor"===b?(b=tinymce.get(d),b||(a=t(a,d),b=tinymce.get(a.id)),b&&(b.setContent(String(g)),b.fire("change"))):(a=t(a,d),null!==a&&(a.value=g,Themify.triggerEvent(a,"change"),"image"!==b&&"SELECT"!==a.nodeName&&Themify.triggerEvent(a,"keyup")))},F=function(a){a=a.getAttribute("data-type");"imageGradient"===a&&(a="image");return a},I=function(){var a={};m.each(tbpDynamic.items,
function(d,b){m.each(b.type,function(b,d){void 0===a[d]&&(a[d]=d)})});return Object.keys(a)},z=function(a){for(var d=tbpDynamic.excludes,b=tbpDynamic.d_label,c=!1,e=I(),f=e.length-1;-1<f;--f)for(var h=a.querySelectorAll('.tb_field[data-type="'+e[f]+'"]'),k=h.length-1;-1<k;--k)if(!h[k].classList.contains("tb_has_dc")&&!h[k].classList.contains("tb_disable_dc")){c=!1;for(var l=d.length-1;-1<l;--l)if(h[k].classList.contains(d[l])){c=!0;break}if(!1===c){h[k].className+=" tb_has_dc";c=document.createElement("label");
l=document.createElement("input");var m=document.createElement("div");c.className="tpb_dc_toggle switch-wrapper";l.type="checkbox";l.className="toggle_switch";m.className="switch_label";m.setAttribute("data-on",b);m.setAttribute("data-off",b);l.addEventListener("change",function(a){a.stopPropagation();C(this)},{passive:!0});c.appendChild(l);c.appendChild(m);h[k].insertBefore(c,h[k].firstChild);C(l,!0)}}};m(window).one("load",function(){if("visual"!==n.mode||!0===Themify.is_builder_loaded)setTimeout(x,
1500);else window.top.Themify.body.one("themify_builder_ready",function(a){setTimeout(x,2500)});m(document).on("tb_repeatable_add_new tb_repeatable_duplicate tb_repeatable_delete",function(a){"tb_repeatable_delete"===a.type?y(null,null,a.detail[0]):z(a.detail[0])}).on("tb_editing_module tb_editing_row tb_editing_column tb_editing_subrow",function(a){a=ThemifyConstructor;var d=ThemifyBuilderCommon.Lightbox.$lightbox[0];q=a.hidden.render({type:"hidden","class":"exclude-from-reset-field",responsive:!1,
control:!1,id:r},a);if(void 0!==a.values[r])try{e="string"===typeof a.values[r]?JSON.parse(a.values[r]):m.extend(!0,{},a.values[r]),q.value=JSON.stringify(e)}catch(b){e={}}else e={};d.getElementsByClassName("tb_options_tab_content")[0].appendChild(q);z(d)});Themify.body.on("themify_builder_tabsactive tb_options_expand",function(a,d,b){if(null!==n.activeModel){var c=ThemifyConstructor.clicked;setTimeout(function(){c=ThemifyConstructor.clicked;"animation"!==c&&"visibility"!==c&&("tb_options_expand"===
a.type&&(b=d,d=null),"styling"===c&&null!==d&&-1!==d.indexOf("_h")||z(b))},"setting"===c?0:50)}})})})(jQuery,tb_app);
